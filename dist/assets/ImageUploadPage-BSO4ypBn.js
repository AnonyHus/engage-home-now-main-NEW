import{s as y,r as t,f as U,j as s}from"./index-Dg9AU6g8.js";import{S as n}from"./sweetalert2.esm.all-BQIkj5Wb.js";const I=async(o,d,a)=>{const{data:u,error:r}=await y.from("Images").insert([{image_url:o,title:a,service_id:d}]);return r?(console.error("Insert error:",r),{success:!1,error:r}):{success:!0,data:u}},_=()=>{const[o,d]=t.useState([]),[a,u]=t.useState(""),[r,m]=t.useState(""),[c,f]=t.useState(!1),[g,h]=t.useState(null),[p,v]=t.useState(null),S="dtvdu1fqj",j="uploads";t.useEffect(()=>{U().then(e=>d(Array.isArray(e)?e:[]))},[]);const w=async()=>{if(!a||!p){n.fire("Select a service and image.");return}f(!0);try{const e=new FormData;e.append("file",p),e.append("upload_preset",j);const i=await(await fetch(`https://api.cloudinary.com/v1_1/${S}/image/upload`,{method:"POST",body:e})).json();if(!i.secure_url)throw new Error("Upload failed");const b=i.secure_url;if(!(await I(b,a,r)).success){n.fire("Failed to save image info to DB.","","error");return}n.fire("Image uploaded and saved successfully!","","success"),h(null),m(""),v(null)}catch{n.fire("Something went wrong.","","error")}finally{f(!1)}},x=e=>{var i;const l=(i=e.target.files)==null?void 0:i[0];l&&(m(l.name.replace(/\.[^/.]+$/,"")),h(URL.createObjectURL(l)),v(l))};return s.jsxs("div",{className:"upload-container",children:[s.jsx("h2",{children:"Upload Image"}),s.jsxs("select",{value:a,onChange:e=>u(e.target.value),className:"modern-select",children:[s.jsx("option",{value:"",children:"-- Select a service --"}),o.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsxs("label",{className:"upload-label",children:[s.jsx("input",{type:"file",accept:"image/*",disabled:c||!a,onChange:x,hidden:!0}),s.jsx("span",{className:`upload-btn${a?"":" disabled"}`,style:{pointerEvents:a?"auto":"none",opacity:a?1:.5},children:c?"Uploading...":"Choose Image"})]}),g&&s.jsxs("div",{className:"preview-card",children:[s.jsx("img",{src:g,alt:"Preview",className:"preview-img"}),s.jsx("p",{className:"preview-title",children:r})]}),s.jsx("button",{className:"upload-btn",style:{marginTop:"1rem",width:"100%"},onClick:w,disabled:c||!p||!a,children:c?"Uploading...":"Submit"})]})};export{_ as default};
