import{r as m,s as h,j as e}from"./index-BTwGVszu.js";import{S as u}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{F as E,a as F,b as O,c as k,d as I}from"./index-BSyINmK0.js";const q=()=>{const[l,v]=m.useState([]),[_,j]=m.useState(!0),[t,g]=m.useState(!1),[i,N]=m.useState("static");m.useEffect(()=>{p()},[]);const p=async()=>{j(!0);try{const{data:r,error:s}=await h.from("outdoor_locations").select("id, img_url, location, outdoor_slug, img_order").order("img_order",{ascending:!0});if(s)throw s;v(r||[])}catch{u.fire("Error","Failed to load locations","error")}finally{j(!1)}},n=l.filter(r=>r.outdoor_slug===i),b=async(r,s)=>{const f=n;if(!(s==="up"&&r===0||s==="down"&&r===f.length-1)){g(!0);try{const c=s==="up"?r-1:r+1,o=f[r],a=f[c],w=o.img_order;o.img_order=a.img_order,a.img_order=w;const S=l.map(d=>d.id===o.id?o:d.id===a.id?a:d);v(S);const L=[h.from("outdoor_locations").update({img_order:o.img_order}).eq("id",o.id),h.from("outdoor_locations").update({img_order:a.img_order}).eq("id",a.id)],x=(await Promise.all(L)).filter(d=>d.error);if(x.length>0)throw console.error("Update errors:",x),new Error("Failed to update order in database");u.fire("Success!","Order updated successfully!","success")}catch(c){console.error("Error updating order:",c),u.fire("Error","Failed to update order","error"),await p()}finally{g(!1)}}},y=async()=>{g(!0);try{const s=n.map((o,a)=>h.from("outdoor_locations").update({img_order:a+1}).eq("id",o.id)),c=(await Promise.all(s)).filter(o=>o.error);if(c.length>0)throw console.error("Update errors:",c),new Error("Some updates failed");u.fire("Success!",`${i} order saved successfully!`,"success"),await p()}catch(r){console.error("Error saving order:",r),u.fire("Error","Failed to save order","error")}finally{g(!1)}};return _?e.jsx("div",{className:"loading-container",children:"Loading locations..."}):l.length===0?e.jsx("div",{className:"no-locations",children:"No locations found"}):e.jsxs("div",{className:"order-management-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{children:"Manage Outdoor Locations Order"}),e.jsxs("div",{className:"tab-navigation",children:[e.jsxs("button",{className:`tab-btn ${i==="static"?"active":""}`,onClick:()=>N("static"),disabled:t,children:[e.jsx(E,{className:"tab-icon"}),"Static Locations (",l.filter(r=>r.outdoor_slug==="static").length,")"]}),e.jsxs("button",{className:`tab-btn ${i==="screen"?"active":""}`,onClick:()=>N("screen"),disabled:t,children:[e.jsx(F,{className:"tab-icon"}),"Screen Locations (",l.filter(r=>r.outdoor_slug==="screen").length,")"]})]}),e.jsxs("button",{className:"save-order-btn",onClick:y,disabled:t||n.length===0,children:[e.jsx(O,{className:"icon"}),t?"Saving...":`Save ${i} Order`]})]}),e.jsx("div",{className:"tab-content",children:n.length===0?e.jsxs("div",{className:"no-locations",children:["No ",i," locations found"]}):e.jsx("div",{className:"locations-grid",children:n.map((r,s)=>e.jsxs("div",{className:"location-card",style:{order:r.img_order},children:[e.jsx("div",{className:"image-container",children:r.img_url?e.jsx("img",{src:r.img_url,alt:r.location,className:"location-image"}):e.jsx("div",{className:"image-placeholder",children:"No Image"})}),e.jsxs("div",{className:"location-info",children:[e.jsx("h3",{className:"location-name",children:r.location}),e.jsxs("p",{className:"location-type",children:["Type: ",e.jsx("span",{className:"type-badge",children:r.outdoor_slug})]}),e.jsxs("p",{className:"location-order",children:["Order: ",r.img_order]})]}),e.jsxs("div",{className:"move-buttons",children:[e.jsx("button",{onClick:()=>b(s,"up"),disabled:s===0||t,className:"move-btn",children:e.jsx(k,{})}),e.jsx("button",{onClick:()=>b(s,"down"),disabled:s===n.length-1||t,className:"move-btn",children:e.jsx(I,{})})]})]},r.id))})})]})};export{q as default};
